#include <stdio.h>
#include <stdlib.h>

struct Node {
    int data;
    struct Node *next;
};

struct Node* newnode(int value);
struct Node* sort(struct Node *head);
void split(struct Node *head, struct Node **f1, struct Node **s1);
struct Node* merge(struct Node *a, struct Node *b);
struct Node* reverse(struct Node *head);
struct Node* concat(struct Node *l1, struct Node *l2);
void display(struct Node *head);

struct Node *newnode(int value) {
    struct Node *n = (struct Node*)malloc(sizeof(struct Node));
    n->data = value;
    n->next = NULL;
    return n;
}

struct Node *sort(struct Node *head) {
    if (!head || !head->next)
        return head;

    struct Node *f1, *s1;
    split(head, &f1, &s1);

    f1 = sort(f1);
    s1 = sort(s1);

    return merge(f1, s1);
}

void split(struct Node *head, struct Node **f1, struct Node **s1) {
    struct Node *p1 = head;
    struct Node *p2 = head->next;

    while (p2) {
        p2 = p2->next;
        if (p2) {
            p1 = p1->next;
            p2 = p2->next;
        }
    }

    *f1 = head;
    *s1 = p1->next;
    p1->next = NULL;
}

struct Node *merge(struct Node *a, struct Node *b) {
    if (!a) return b;
    if (!b) return a;

    if (a->data <= b->data) {
        a->next = merge(a->next, b);
        return a;
    } else {
        b->next = merge(a, b->next);
        return b;
    }
}

struct Node *reverse(struct Node *head) {
    struct Node *prev = NULL;
    struct Node *nextnode;

    while (head) {
        nextnode = head->next;
        head->next = prev;
        prev = head;
        head = nextnode;
    }

    return prev;
}

struct Node *concat(struct Node *l1, struct Node *l2) {
    if (!l1) return l2;
    if (!l2) return l1;

    struct Node *temp = l1;
    while (temp->next) {
        temp = temp->next;
    }
    temp->next = l2;

    return l1;
}

void display(struct Node *head) {
    if (!head) {
        printf("List is empty\n");
        return;
    }
    while (head) {
        printf("%d ", head->data);
        head = head->next;
    }
    printf("\n");
}

int main() {
    struct Node *head = NULL;
    int arr[] = {4, 1, 7, 3, 9, 2};
    for (int i = 5; i >= 0; i--) {
        struct Node *n = newnode(arr[i]);
        n->next = head;
        head = n;
    }

    printf("List: ");
    display(head);

    head = sort(head);
    printf("Sorted: ");
    display(head);

    head = reverse(head);
    printf("Reversed: ");
    display(head);

    struct Node *list2 = NULL;
    list2 = newnode(100);
    list2->next = newnode(200);

    printf("Second list: ");
    display(list2);

    head = concat(head, list2);
    printf("After concatenation: ");
    display(head);

    return 0;
}
